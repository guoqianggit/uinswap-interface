{"ast":null,"code":"import _regeneratorRuntime from\"/root/code/solidity/uniswap/testInterface/uinswap-interface/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/root/code/solidity/uniswap/testInterface/uinswap-interface/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _objectSpread from\"/root/code/solidity/uniswap/testInterface/uinswap-interface/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2\";import _slicedToArray from\"/root/code/solidity/uniswap/testInterface/uinswap-interface/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import{UNI}from'./../../constants/index';import{TokenAmount}from'@uniswap/sdk';import{isAddress}from'ethers/lib/utils';import{useGovernanceContract,useUniContract}from'../../hooks/useContract';import{useSingleCallResult,useSingleContractMultipleData}from'../multicall/hooks';import{useActiveWeb3React}from'../../hooks';import{ethers,utils}from'ethers';import{calculateGasMargin}from'../../utils';import{useTransactionAdder}from'../transactions/hooks';import{useState,useEffect,useCallback}from'react';import{abi as GOV_ABI}from'@uniswap/governance/build/GovernorAlpha.json';var enumerateProposalState=function enumerateProposalState(state){var proposalStates=['pending','active','canceled','defeated','succeeded','queued','expired','executed'];return proposalStates[state];};// get count of all proposals made\nexport function useProposalCount(){var gov=useGovernanceContract();var res=useSingleCallResult(gov,'proposalCount');if(res.result&&!res.loading){return parseInt(res.result[0]);}return undefined;}/**\n * Need proposal events to get description data emitted from\n * new proposal event.\n */export function useDataFromEventLogs(){var _govContract$filters;var _useActiveWeb3React=useActiveWeb3React(),library=_useActiveWeb3React.library;var _useState=useState(),_useState2=_slicedToArray(_useState,2),formattedEvents=_useState2[0],setFormattedEvents=_useState2[1];var govContract=useGovernanceContract();// create filter for these specific events\nvar filter=_objectSpread(_objectSpread({},govContract===null||govContract===void 0?void 0:(_govContract$filters=govContract.filters)===null||_govContract$filters===void 0?void 0:_govContract$filters['ProposalCreated']()),{},{fromBlock:0,toBlock:'latest'});var eventParser=new ethers.utils.Interface(GOV_ABI);useEffect(function(){function fetchData(){return _fetchData.apply(this,arguments);}function _fetchData(){_fetchData=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var pastEvents,formattedEventData;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.next=2;return library===null||library===void 0?void 0:library.getLogs(filter);case 2:pastEvents=_context.sent;// reverse events to get them from newest to odlest\nformattedEventData=pastEvents===null||pastEvents===void 0?void 0:pastEvents.map(function(event){var eventParsed=eventParser.parseLog(event).args;return{description:eventParsed.description,details:eventParsed.targets.map(function(target,i){var signature=eventParsed.signatures[i];var _signature$substr$spl=signature.substr(0,signature.length-1).split('('),_signature$substr$spl2=_slicedToArray(_signature$substr$spl,2),name=_signature$substr$spl2[0],types=_signature$substr$spl2[1];var calldata=eventParsed.calldatas[i];var decoded=utils.defaultAbiCoder.decode(types.split(','),calldata);return{target:target,functionSig:name,callData:decoded.join(', ')};})};}).reverse();setFormattedEvents(formattedEventData);case 5:case\"end\":return _context.stop();}}},_callee);}));return _fetchData.apply(this,arguments);}if(!formattedEvents){fetchData();}},[eventParser,filter,library,formattedEvents]);return formattedEvents;}// get data for all past and active proposals\nexport function useAllProposalData(){var proposalCount=useProposalCount();var govContract=useGovernanceContract();var proposalIndexes=[];for(var i=1;i<=(proposalCount!==null&&proposalCount!==void 0?proposalCount:0);i++){proposalIndexes.push([i]);}// get metadata from past events\nvar formattedEvents=useDataFromEventLogs();// get all proposal entities\nvar allProposals=useSingleContractMultipleData(govContract,'proposals',proposalIndexes);// get all proposal states\nvar allProposalStates=useSingleContractMultipleData(govContract,'state',proposalIndexes);if(formattedEvents&&allProposals&&allProposalStates){allProposals.reverse();allProposalStates.reverse();return allProposals.filter(function(p,i){var _allProposalStates$i;return Boolean(p.result)&&Boolean((_allProposalStates$i=allProposalStates[i])===null||_allProposalStates$i===void 0?void 0:_allProposalStates$i.result)&&Boolean(formattedEvents[i]);}).map(function(p,i){var _allProposals$i,_allProposals$i$resul,_formattedEvents$i$de,_allProposals$i2,_allProposals$i2$resu,_enumerateProposalSta,_allProposalStates$i2,_allProposalStates$i3,_allProposals$i3,_allProposals$i3$resu,_allProposals$i4,_allProposals$i4$resu,_allProposals$i5,_allProposals$i5$resu,_allProposals$i5$resu2,_allProposals$i6,_allProposals$i6$resu,_allProposals$i6$resu2;var formattedProposal={id:(_allProposals$i=allProposals[i])===null||_allProposals$i===void 0?void 0:(_allProposals$i$resul=_allProposals$i.result)===null||_allProposals$i$resul===void 0?void 0:_allProposals$i$resul.id.toString(),title:((_formattedEvents$i$de=formattedEvents[i].description)===null||_formattedEvents$i$de===void 0?void 0:_formattedEvents$i$de.split(/# |\\n/g)[1])||'Untitled',description:formattedEvents[i].description||'No description.',proposer:(_allProposals$i2=allProposals[i])===null||_allProposals$i2===void 0?void 0:(_allProposals$i2$resu=_allProposals$i2.result)===null||_allProposals$i2$resu===void 0?void 0:_allProposals$i2$resu.proposer,status:(_enumerateProposalSta=enumerateProposalState((_allProposalStates$i2=allProposalStates[i])===null||_allProposalStates$i2===void 0?void 0:(_allProposalStates$i3=_allProposalStates$i2.result)===null||_allProposalStates$i3===void 0?void 0:_allProposalStates$i3[0]))!==null&&_enumerateProposalSta!==void 0?_enumerateProposalSta:'Undetermined',forCount:parseFloat(ethers.utils.formatUnits((_allProposals$i3=allProposals[i])===null||_allProposals$i3===void 0?void 0:(_allProposals$i3$resu=_allProposals$i3.result)===null||_allProposals$i3$resu===void 0?void 0:_allProposals$i3$resu.forVotes.toString(),18)),againstCount:parseFloat(ethers.utils.formatUnits((_allProposals$i4=allProposals[i])===null||_allProposals$i4===void 0?void 0:(_allProposals$i4$resu=_allProposals$i4.result)===null||_allProposals$i4$resu===void 0?void 0:_allProposals$i4$resu.againstVotes.toString(),18)),startBlock:parseInt((_allProposals$i5=allProposals[i])===null||_allProposals$i5===void 0?void 0:(_allProposals$i5$resu=_allProposals$i5.result)===null||_allProposals$i5$resu===void 0?void 0:(_allProposals$i5$resu2=_allProposals$i5$resu.startBlock)===null||_allProposals$i5$resu2===void 0?void 0:_allProposals$i5$resu2.toString()),endBlock:parseInt((_allProposals$i6=allProposals[i])===null||_allProposals$i6===void 0?void 0:(_allProposals$i6$resu=_allProposals$i6.result)===null||_allProposals$i6$resu===void 0?void 0:(_allProposals$i6$resu2=_allProposals$i6$resu.endBlock)===null||_allProposals$i6$resu2===void 0?void 0:_allProposals$i6$resu2.toString()),details:formattedEvents[i].details};return formattedProposal;});}else{return[];}}export function useProposalData(id){var allProposalData=useAllProposalData();return allProposalData===null||allProposalData===void 0?void 0:allProposalData.find(function(p){return p.id===id;});}// get the users delegatee if it exists\nexport function useUserDelegatee(){var _result$;var _useActiveWeb3React2=useActiveWeb3React(),account=_useActiveWeb3React2.account;var uniContract=useUniContract();var _useSingleCallResult=useSingleCallResult(uniContract,'delegates',[account!==null&&account!==void 0?account:undefined]),result=_useSingleCallResult.result;return(_result$=result===null||result===void 0?void 0:result[0])!==null&&_result$!==void 0?_result$:undefined;}// gets the users current votes\nexport function useUserVotes(){var _useSingleCallResult2,_useSingleCallResult3;var _useActiveWeb3React3=useActiveWeb3React(),account=_useActiveWeb3React3.account,chainId=_useActiveWeb3React3.chainId;var uniContract=useUniContract();// check for available votes\nvar uni=chainId?UNI[chainId]:undefined;var votes=(_useSingleCallResult2=useSingleCallResult(uniContract,'getCurrentVotes',[account!==null&&account!==void 0?account:undefined]))===null||_useSingleCallResult2===void 0?void 0:(_useSingleCallResult3=_useSingleCallResult2.result)===null||_useSingleCallResult3===void 0?void 0:_useSingleCallResult3[0];return votes&&uni?new TokenAmount(uni,votes):undefined;}// fetch available votes as of block (usually proposal start block)\nexport function useUserVotesAsOfBlock(block){var _useSingleCallResult4,_useSingleCallResult5;var _useActiveWeb3React4=useActiveWeb3React(),account=_useActiveWeb3React4.account,chainId=_useActiveWeb3React4.chainId;var uniContract=useUniContract();// check for available votes\nvar uni=chainId?UNI[chainId]:undefined;var votes=(_useSingleCallResult4=useSingleCallResult(uniContract,'getPriorVotes',[account!==null&&account!==void 0?account:undefined,block!==null&&block!==void 0?block:undefined]))===null||_useSingleCallResult4===void 0?void 0:(_useSingleCallResult5=_useSingleCallResult4.result)===null||_useSingleCallResult5===void 0?void 0:_useSingleCallResult5[0];return votes&&uni?new TokenAmount(uni,votes):undefined;}export function useDelegateCallback(){var _useActiveWeb3React5=useActiveWeb3React(),account=_useActiveWeb3React5.account,chainId=_useActiveWeb3React5.chainId,library=_useActiveWeb3React5.library;var addTransaction=useTransactionAdder();var uniContract=useUniContract();return useCallback(function(delegatee){var _uniContract$estimate;if(!library||!chainId||!account||!isAddress(delegatee!==null&&delegatee!==void 0?delegatee:''))return undefined;var args=[delegatee];if(!uniContract)throw new Error('No UNI Contract!');return(_uniContract$estimate=uniContract.estimateGas).delegate.apply(_uniContract$estimate,args.concat([{}])).then(function(estimatedGasLimit){return uniContract.delegate.apply(uniContract,args.concat([{value:null,gasLimit:calculateGasMargin(estimatedGasLimit)}])).then(function(response){addTransaction(response,{summary:\"Delegated votes\"});return response.hash;});});},[account,addTransaction,chainId,library,uniContract]);}export function useVoteCallback(){var _useActiveWeb3React6=useActiveWeb3React(),account=_useActiveWeb3React6.account;var govContract=useGovernanceContract();var addTransaction=useTransactionAdder();var voteCallback=useCallback(function(proposalId,support){var _govContract$estimate;if(!account||!govContract||!proposalId)return;var args=[proposalId,support];return(_govContract$estimate=govContract.estimateGas).castVote.apply(_govContract$estimate,args.concat([{}])).then(function(estimatedGasLimit){return govContract.castVote.apply(govContract,args.concat([{value:null,gasLimit:calculateGasMargin(estimatedGasLimit)}])).then(function(response){addTransaction(response,{summary:\"Voted \".concat(support?'for ':'against',\" proposal \").concat(proposalId)});return response.hash;});});},[account,addTransaction,govContract]);return{voteCallback:voteCallback};}","map":{"version":3,"sources":["/root/code/solidity/uniswap/testInterface/uinswap-interface/src/state/governance/hooks.ts"],"names":["UNI","TokenAmount","isAddress","useGovernanceContract","useUniContract","useSingleCallResult","useSingleContractMultipleData","useActiveWeb3React","ethers","utils","calculateGasMargin","useTransactionAdder","useState","useEffect","useCallback","abi","GOV_ABI","enumerateProposalState","state","proposalStates","useProposalCount","gov","res","result","loading","parseInt","undefined","useDataFromEventLogs","library","formattedEvents","setFormattedEvents","govContract","filter","filters","fromBlock","toBlock","eventParser","Interface","fetchData","getLogs","pastEvents","formattedEventData","map","event","eventParsed","parseLog","args","description","details","targets","target","i","signature","signatures","substr","length","split","name","types","calldata","calldatas","decoded","defaultAbiCoder","decode","functionSig","callData","join","reverse","useAllProposalData","proposalCount","proposalIndexes","push","allProposals","allProposalStates","p","Boolean","formattedProposal","id","toString","title","proposer","status","forCount","parseFloat","formatUnits","forVotes","againstCount","againstVotes","startBlock","endBlock","useProposalData","allProposalData","find","useUserDelegatee","account","uniContract","useUserVotes","chainId","uni","votes","useUserVotesAsOfBlock","block","useDelegateCallback","addTransaction","delegatee","Error","estimateGas","delegate","then","estimatedGasLimit","value","gasLimit","response","summary","hash","useVoteCallback","voteCallback","proposalId","support","castVote"],"mappings":"osBAAA,OAASA,GAAT,KAAoB,yBAApB,CACA,OAASC,WAAT,KAA4B,cAA5B,CACA,OAASC,SAAT,KAA0B,kBAA1B,CACA,OAASC,qBAAT,CAAgCC,cAAhC,KAAsD,yBAAtD,CACA,OAASC,mBAAT,CAA8BC,6BAA9B,KAAmE,oBAAnE,CACA,OAASC,kBAAT,KAAmC,aAAnC,CACA,OAASC,MAAT,CAAiBC,KAAjB,KAA8B,QAA9B,CACA,OAASC,kBAAT,KAAmC,aAAnC,CAEA,OAASC,mBAAT,KAAoC,uBAApC,CACA,OAASC,QAAT,CAAmBC,SAAnB,CAA8BC,WAA9B,KAAiD,OAAjD,CACA,OAASC,GAAG,GAAIC,CAAAA,OAAhB,KAA+B,8CAA/B,CAqBA,GAAMC,CAAAA,sBAAsB,CAAG,QAAzBA,CAAAA,sBAAyB,CAACC,KAAD,CAAmB,CAChD,GAAMC,CAAAA,cAAc,CAAG,CAAC,SAAD,CAAY,QAAZ,CAAsB,UAAtB,CAAkC,UAAlC,CAA8C,WAA9C,CAA2D,QAA3D,CAAqE,SAArE,CAAgF,UAAhF,CAAvB,CACA,MAAOA,CAAAA,cAAc,CAACD,KAAD,CAArB,CACD,CAHD,CAKA;AACA,MAAO,SAASE,CAAAA,gBAAT,EAAgD,CACrD,GAAMC,CAAAA,GAAG,CAAGlB,qBAAqB,EAAjC,CACA,GAAMmB,CAAAA,GAAG,CAAGjB,mBAAmB,CAACgB,GAAD,CAAM,eAAN,CAA/B,CACA,GAAIC,GAAG,CAACC,MAAJ,EAAc,CAACD,GAAG,CAACE,OAAvB,CAAgC,CAC9B,MAAOC,CAAAA,QAAQ,CAACH,GAAG,CAACC,MAAJ,CAAW,CAAX,CAAD,CAAf,CACD,CACD,MAAOG,CAAAA,SAAP,CACD,CAED;;;GAIA,MAAO,SAASC,CAAAA,oBAAT,EAAgC,kDACjBpB,kBAAkB,EADD,CAC7BqB,OAD6B,qBAC7BA,OAD6B,eAEShB,QAAQ,EAFjB,wCAE9BiB,eAF8B,eAEbC,kBAFa,eAGrC,GAAMC,CAAAA,WAAW,CAAG5B,qBAAqB,EAAzC,CAEA;AACA,GAAM6B,CAAAA,MAAM,gCAAQD,WAAR,SAAQA,WAAR,uCAAQA,WAAW,CAAEE,OAArB,+CAAQ,qBAAuB,iBAAvB,GAAR,MAAqDC,SAAS,CAAE,CAAhE,CAAmEC,OAAO,CAAE,QAA5E,EAAZ,CACA,GAAMC,CAAAA,WAAW,CAAG,GAAI5B,CAAAA,MAAM,CAACC,KAAP,CAAa4B,SAAjB,CAA2BrB,OAA3B,CAApB,CAEAH,SAAS,CAAC,UAAM,SACCyB,CAAAA,SADD,qIACd,2LAC2BV,CAAAA,OAD3B,SAC2BA,OAD3B,iBAC2BA,OAAO,CAAEW,OAAT,CAAiBP,MAAjB,CAD3B,QACQQ,UADR,eAEE;AACMC,kBAHR,CAG6BD,UAH7B,SAG6BA,UAH7B,iBAG6BA,UAAU,CACjCE,GADuB,CACnB,SAAAC,KAAK,CAAI,CACb,GAAMC,CAAAA,WAAW,CAAGR,WAAW,CAACS,QAAZ,CAAqBF,KAArB,EAA4BG,IAAhD,CACA,MAAO,CACLC,WAAW,CAAEH,WAAW,CAACG,WADpB,CAELC,OAAO,CAAEJ,WAAW,CAACK,OAAZ,CAAoBP,GAApB,CAAwB,SAACQ,MAAD,CAAiBC,CAAjB,CAA+B,CAC9D,GAAMC,CAAAA,SAAS,CAAGR,WAAW,CAACS,UAAZ,CAAuBF,CAAvB,CAAlB,CAD8D,0BAExCC,SAAS,CAACE,MAAV,CAAiB,CAAjB,CAAoBF,SAAS,CAACG,MAAV,CAAmB,CAAvC,EAA0CC,KAA1C,CAAgD,GAAhD,CAFwC,gEAEvDC,IAFuD,2BAEjDC,KAFiD,2BAI9D,GAAMC,CAAAA,QAAQ,CAAGf,WAAW,CAACgB,SAAZ,CAAsBT,CAAtB,CAAjB,CACA,GAAMU,CAAAA,OAAO,CAAGpD,KAAK,CAACqD,eAAN,CAAsBC,MAAtB,CAA6BL,KAAK,CAACF,KAAN,CAAY,GAAZ,CAA7B,CAA+CG,QAA/C,CAAhB,CAEA,MAAO,CACLT,MAAM,CAANA,MADK,CAELc,WAAW,CAAEP,IAFR,CAGLQ,QAAQ,CAAEJ,OAAO,CAACK,IAAR,CAAa,IAAb,CAHL,CAAP,CAKD,CAZQ,CAFJ,CAAP,CAgBD,CAnBwB,EAoBxBC,OApBwB,EAH7B,CAwBErC,kBAAkB,CAACW,kBAAD,CAAlB,CAxBF,sDADc,4CA2Bd,GAAI,CAACZ,eAAL,CAAsB,CACpBS,SAAS,GACV,CACF,CA9BQ,CA8BN,CAACF,WAAD,CAAcJ,MAAd,CAAsBJ,OAAtB,CAA+BC,eAA/B,CA9BM,CAAT,CAgCA,MAAOA,CAAAA,eAAP,CACD,CAED;AACA,MAAO,SAASuC,CAAAA,kBAAT,EAA8B,CACnC,GAAMC,CAAAA,aAAa,CAAGjD,gBAAgB,EAAtC,CACA,GAAMW,CAAAA,WAAW,CAAG5B,qBAAqB,EAAzC,CAEA,GAAMmE,CAAAA,eAAe,CAAG,EAAxB,CACA,IAAK,GAAInB,CAAAA,CAAC,CAAG,CAAb,CAAgBA,CAAC,GAAKkB,aAAL,SAAKA,aAAL,UAAKA,aAAL,CAAsB,CAAtB,CAAjB,CAA2ClB,CAAC,EAA5C,CAAgD,CAC9CmB,eAAe,CAACC,IAAhB,CAAqB,CAACpB,CAAD,CAArB,EACD,CAED;AACA,GAAMtB,CAAAA,eAAe,CAAGF,oBAAoB,EAA5C,CAEA;AACA,GAAM6C,CAAAA,YAAY,CAAGlE,6BAA6B,CAACyB,WAAD,CAAc,WAAd,CAA2BuC,eAA3B,CAAlD,CAEA;AACA,GAAMG,CAAAA,iBAAiB,CAAGnE,6BAA6B,CAACyB,WAAD,CAAc,OAAd,CAAuBuC,eAAvB,CAAvD,CAEA,GAAIzC,eAAe,EAAI2C,YAAnB,EAAmCC,iBAAvC,CAA0D,CACxDD,YAAY,CAACL,OAAb,GACAM,iBAAiB,CAACN,OAAlB,GAEA,MAAOK,CAAAA,YAAY,CAChBxC,MADI,CACG,SAAC0C,CAAD,CAAIvB,CAAJ,CAAU,0BAChB,MAAOwB,CAAAA,OAAO,CAACD,CAAC,CAACnD,MAAH,CAAP,EAAqBoD,OAAO,uBAACF,iBAAiB,CAACtB,CAAD,CAAlB,+CAAC,qBAAsB5B,MAAvB,CAA5B,EAA8DoD,OAAO,CAAC9C,eAAe,CAACsB,CAAD,CAAhB,CAA5E,CACD,CAHI,EAIJT,GAJI,CAIA,SAACgC,CAAD,CAAIvB,CAAJ,CAAU,oXACb,GAAMyB,CAAAA,iBAA+B,CAAG,CACtCC,EAAE,kBAAEL,YAAY,CAACrB,CAAD,CAAd,iEAAE,gBAAiB5B,MAAnB,gDAAE,sBAAyBsD,EAAzB,CAA4BC,QAA5B,EADkC,CAEtCC,KAAK,CAAE,wBAAAlD,eAAe,CAACsB,CAAD,CAAf,CAAmBJ,WAAnB,sEAAgCS,KAAhC,CAAsC,QAAtC,EAAgD,CAAhD,IAAsD,UAFvB,CAGtCT,WAAW,CAAElB,eAAe,CAACsB,CAAD,CAAf,CAAmBJ,WAAnB,EAAkC,iBAHT,CAItCiC,QAAQ,mBAAER,YAAY,CAACrB,CAAD,CAAd,kEAAE,iBAAiB5B,MAAnB,gDAAE,sBAAyByD,QAJG,CAKtCC,MAAM,wBAAEhE,sBAAsB,wBAACwD,iBAAiB,CAACtB,CAAD,CAAlB,uEAAC,sBAAsB5B,MAAvB,gDAAC,sBAA+B,CAA/B,CAAD,CAAxB,+DAA+D,cAL/B,CAMtC2D,QAAQ,CAAEC,UAAU,CAAC3E,MAAM,CAACC,KAAP,CAAa2E,WAAb,mBAAyBZ,YAAY,CAACrB,CAAD,CAArC,kEAAyB,iBAAiB5B,MAA1C,gDAAyB,sBAAyB8D,QAAzB,CAAkCP,QAAlC,EAAzB,CAAuE,EAAvE,CAAD,CANkB,CAOtCQ,YAAY,CAAEH,UAAU,CAAC3E,MAAM,CAACC,KAAP,CAAa2E,WAAb,mBAAyBZ,YAAY,CAACrB,CAAD,CAArC,kEAAyB,iBAAiB5B,MAA1C,gDAAyB,sBAAyBgE,YAAzB,CAAsCT,QAAtC,EAAzB,CAA2E,EAA3E,CAAD,CAPc,CAQtCU,UAAU,CAAE/D,QAAQ,mBAAC+C,YAAY,CAACrB,CAAD,CAAb,kEAAC,iBAAiB5B,MAAlB,wEAAC,sBAAyBiE,UAA1B,iDAAC,uBAAqCV,QAArC,EAAD,CARkB,CAStCW,QAAQ,CAAEhE,QAAQ,mBAAC+C,YAAY,CAACrB,CAAD,CAAb,kEAAC,iBAAiB5B,MAAlB,wEAAC,sBAAyBkE,QAA1B,iDAAC,uBAAmCX,QAAnC,EAAD,CAToB,CAUtC9B,OAAO,CAAEnB,eAAe,CAACsB,CAAD,CAAf,CAAmBH,OAVU,CAAxC,CAYA,MAAO4B,CAAAA,iBAAP,CACD,CAlBI,CAAP,CAmBD,CAvBD,IAuBO,CACL,MAAO,EAAP,CACD,CACF,CAED,MAAO,SAASc,CAAAA,eAAT,CAAyBb,EAAzB,CAA+D,CACpE,GAAMc,CAAAA,eAAe,CAAGvB,kBAAkB,EAA1C,CACA,MAAOuB,CAAAA,eAAP,SAAOA,eAAP,iBAAOA,eAAe,CAAEC,IAAjB,CAAsB,SAAAlB,CAAC,QAAIA,CAAAA,CAAC,CAACG,EAAF,GAASA,EAAb,EAAvB,CAAP,CACD,CAED;AACA,MAAO,SAASgB,CAAAA,gBAAT,EAAoC,uCACrBtF,kBAAkB,EADG,CACjCuF,OADiC,sBACjCA,OADiC,CAEzC,GAAMC,CAAAA,WAAW,CAAG3F,cAAc,EAAlC,CAFyC,yBAGtBC,mBAAmB,CAAC0F,WAAD,CAAc,WAAd,CAA2B,CAACD,OAAD,SAACA,OAAD,UAACA,OAAD,CAAYpE,SAAZ,CAA3B,CAHG,CAGjCH,MAHiC,sBAGjCA,MAHiC,CAIzC,gBAAOA,MAAP,SAAOA,MAAP,iBAAOA,MAAM,CAAG,CAAH,CAAb,qCAAsBG,SAAtB,CACD,CAED;AACA,MAAO,SAASsE,CAAAA,YAAT,EAAiD,0EACzBzF,kBAAkB,EADO,CAC9CuF,OAD8C,sBAC9CA,OAD8C,CACrCG,OADqC,sBACrCA,OADqC,CAEtD,GAAMF,CAAAA,WAAW,CAAG3F,cAAc,EAAlC,CAEA;AACA,GAAM8F,CAAAA,GAAG,CAAGD,OAAO,CAAGjG,GAAG,CAACiG,OAAD,CAAN,CAAkBvE,SAArC,CACA,GAAMyE,CAAAA,KAAK,wBAAG9F,mBAAmB,CAAC0F,WAAD,CAAc,iBAAd,CAAiC,CAACD,OAAD,SAACA,OAAD,UAACA,OAAD,CAAYpE,SAAZ,CAAjC,CAAtB,uEAAG,sBAA6EH,MAAhF,gDAAG,sBAAsF,CAAtF,CAAd,CACA,MAAO4E,CAAAA,KAAK,EAAID,GAAT,CAAe,GAAIjG,CAAAA,WAAJ,CAAgBiG,GAAhB,CAAqBC,KAArB,CAAf,CAA6CzE,SAApD,CACD,CAED;AACA,MAAO,SAAS0E,CAAAA,qBAAT,CAA+BC,KAA/B,CAAmF,0EAC3D9F,kBAAkB,EADyC,CAChFuF,OADgF,sBAChFA,OADgF,CACvEG,OADuE,sBACvEA,OADuE,CAExF,GAAMF,CAAAA,WAAW,CAAG3F,cAAc,EAAlC,CAEA;AACA,GAAM8F,CAAAA,GAAG,CAAGD,OAAO,CAAGjG,GAAG,CAACiG,OAAD,CAAN,CAAkBvE,SAArC,CACA,GAAMyE,CAAAA,KAAK,wBAAG9F,mBAAmB,CAAC0F,WAAD,CAAc,eAAd,CAA+B,CAACD,OAAD,SAACA,OAAD,UAACA,OAAD,CAAYpE,SAAZ,CAAuB2E,KAAvB,SAAuBA,KAAvB,UAAuBA,KAAvB,CAAgC3E,SAAhC,CAA/B,CAAtB,uEAAG,sBACVH,MADO,gDAAG,sBACD,CADC,CAAd,CAEA,MAAO4E,CAAAA,KAAK,EAAID,GAAT,CAAe,GAAIjG,CAAAA,WAAJ,CAAgBiG,GAAhB,CAAqBC,KAArB,CAAf,CAA6CzE,SAApD,CACD,CAED,MAAO,SAAS4E,CAAAA,mBAAT,EAA+F,0BAC9D/F,kBAAkB,EAD4C,CAC5FuF,OAD4F,sBAC5FA,OAD4F,CACnFG,OADmF,sBACnFA,OADmF,CAC1ErE,OAD0E,sBAC1EA,OAD0E,CAEpG,GAAM2E,CAAAA,cAAc,CAAG5F,mBAAmB,EAA1C,CAEA,GAAMoF,CAAAA,WAAW,CAAG3F,cAAc,EAAlC,CAEA,MAAOU,CAAAA,WAAW,CAChB,SAAC0F,SAAD,CAAmC,2BACjC,GAAI,CAAC5E,OAAD,EAAY,CAACqE,OAAb,EAAwB,CAACH,OAAzB,EAAoC,CAAC5F,SAAS,CAACsG,SAAD,SAACA,SAAD,UAACA,SAAD,CAAc,EAAd,CAAlD,CAAqE,MAAO9E,CAAAA,SAAP,CACrE,GAAMoB,CAAAA,IAAI,CAAG,CAAC0D,SAAD,CAAb,CACA,GAAI,CAACT,WAAL,CAAkB,KAAM,IAAIU,CAAAA,KAAJ,CAAU,kBAAV,CAAN,CAClB,MAAO,uBAAAV,WAAW,CAACW,WAAZ,EAAwBC,QAAxB,6BAAoC7D,IAApC,SAA0C,EAA1C,IAA8C8D,IAA9C,CAAmD,SAAAC,iBAAiB,CAAI,CAC7E,MAAOd,CAAAA,WAAW,CACfY,QADI,OAAAZ,WAAW,CACHjD,IADG,SACG,CAAEgE,KAAK,CAAE,IAAT,CAAeC,QAAQ,CAAErG,kBAAkB,CAACmG,iBAAD,CAA3C,CADH,GAAX,CAEJD,IAFI,CAEC,SAACI,QAAD,CAAmC,CACvCT,cAAc,CAACS,QAAD,CAAW,CACvBC,OAAO,kBADgB,CAAX,CAAd,CAGA,MAAOD,CAAAA,QAAQ,CAACE,IAAhB,CACD,CAPI,CAAP,CAQD,CATM,CAAP,CAUD,CAfe,CAgBhB,CAACpB,OAAD,CAAUS,cAAV,CAA0BN,OAA1B,CAAmCrE,OAAnC,CAA4CmE,WAA5C,CAhBgB,CAAlB,CAkBD,CAED,MAAO,SAASoB,CAAAA,eAAT,EAEL,0BACoB5G,kBAAkB,EADtC,CACQuF,OADR,sBACQA,OADR,CAGA,GAAM/D,CAAAA,WAAW,CAAG5B,qBAAqB,EAAzC,CACA,GAAMoG,CAAAA,cAAc,CAAG5F,mBAAmB,EAA1C,CAEA,GAAMyG,CAAAA,YAAY,CAAGtG,WAAW,CAC9B,SAACuG,UAAD,CAAiCC,OAAjC,CAAsD,2BACpD,GAAI,CAACxB,OAAD,EAAY,CAAC/D,WAAb,EAA4B,CAACsF,UAAjC,CAA6C,OAC7C,GAAMvE,CAAAA,IAAI,CAAG,CAACuE,UAAD,CAAaC,OAAb,CAAb,CACA,MAAO,uBAAAvF,WAAW,CAAC2E,WAAZ,EAAwBa,QAAxB,6BAAoCzE,IAApC,SAA0C,EAA1C,IAA8C8D,IAA9C,CAAmD,SAAAC,iBAAiB,CAAI,CAC7E,MAAO9E,CAAAA,WAAW,CACfwF,QADI,OAAAxF,WAAW,CACHe,IADG,SACG,CAAEgE,KAAK,CAAE,IAAT,CAAeC,QAAQ,CAAErG,kBAAkB,CAACmG,iBAAD,CAA3C,CADH,GAAX,CAEJD,IAFI,CAEC,SAACI,QAAD,CAAmC,CACvCT,cAAc,CAACS,QAAD,CAAW,CACvBC,OAAO,iBAAWK,OAAO,CAAG,MAAH,CAAY,SAA9B,sBAAoDD,UAApD,CADgB,CAAX,CAAd,CAGA,MAAOL,CAAAA,QAAQ,CAACE,IAAhB,CACD,CAPI,CAAP,CAQD,CATM,CAAP,CAUD,CAd6B,CAe9B,CAACpB,OAAD,CAAUS,cAAV,CAA0BxE,WAA1B,CAf8B,CAAhC,CAiBA,MAAO,CAAEqF,YAAY,CAAZA,YAAF,CAAP,CACD","sourcesContent":["import { UNI } from './../../constants/index'\nimport { TokenAmount } from '@uniswap/sdk'\nimport { isAddress } from 'ethers/lib/utils'\nimport { useGovernanceContract, useUniContract } from '../../hooks/useContract'\nimport { useSingleCallResult, useSingleContractMultipleData } from '../multicall/hooks'\nimport { useActiveWeb3React } from '../../hooks'\nimport { ethers, utils } from 'ethers'\nimport { calculateGasMargin } from '../../utils'\nimport { TransactionResponse } from '@ethersproject/providers'\nimport { useTransactionAdder } from '../transactions/hooks'\nimport { useState, useEffect, useCallback } from 'react'\nimport { abi as GOV_ABI } from '@uniswap/governance/build/GovernorAlpha.json'\n\ninterface ProposalDetail {\n  target: string\n  functionSig: string\n  callData: string\n}\n\nexport interface ProposalData {\n  id: string\n  title: string\n  description: string\n  proposer: string\n  status: string\n  forCount: number\n  againstCount: number\n  startBlock: number\n  endBlock: number\n  details: ProposalDetail[]\n}\n\nconst enumerateProposalState = (state: number) => {\n  const proposalStates = ['pending', 'active', 'canceled', 'defeated', 'succeeded', 'queued', 'expired', 'executed']\n  return proposalStates[state]\n}\n\n// get count of all proposals made\nexport function useProposalCount(): number | undefined {\n  const gov = useGovernanceContract()\n  const res = useSingleCallResult(gov, 'proposalCount')\n  if (res.result && !res.loading) {\n    return parseInt(res.result[0])\n  }\n  return undefined\n}\n\n/**\n * Need proposal events to get description data emitted from\n * new proposal event.\n */\nexport function useDataFromEventLogs() {\n  const { library } = useActiveWeb3React()\n  const [formattedEvents, setFormattedEvents] = useState<any>()\n  const govContract = useGovernanceContract()\n\n  // create filter for these specific events\n  const filter = { ...govContract?.filters?.['ProposalCreated'](), fromBlock: 0, toBlock: 'latest' }\n  const eventParser = new ethers.utils.Interface(GOV_ABI)\n\n  useEffect(() => {\n    async function fetchData() {\n      const pastEvents = await library?.getLogs(filter)\n      // reverse events to get them from newest to odlest\n      const formattedEventData = pastEvents\n        ?.map(event => {\n          const eventParsed = eventParser.parseLog(event).args\n          return {\n            description: eventParsed.description,\n            details: eventParsed.targets.map((target: string, i: number) => {\n              const signature = eventParsed.signatures[i]\n              const [name, types] = signature.substr(0, signature.length - 1).split('(')\n\n              const calldata = eventParsed.calldatas[i]\n              const decoded = utils.defaultAbiCoder.decode(types.split(','), calldata)\n\n              return {\n                target,\n                functionSig: name,\n                callData: decoded.join(', ')\n              }\n            })\n          }\n        })\n        .reverse()\n      setFormattedEvents(formattedEventData)\n    }\n    if (!formattedEvents) {\n      fetchData()\n    }\n  }, [eventParser, filter, library, formattedEvents])\n\n  return formattedEvents\n}\n\n// get data for all past and active proposals\nexport function useAllProposalData() {\n  const proposalCount = useProposalCount()\n  const govContract = useGovernanceContract()\n\n  const proposalIndexes = []\n  for (let i = 1; i <= (proposalCount ?? 0); i++) {\n    proposalIndexes.push([i])\n  }\n\n  // get metadata from past events\n  const formattedEvents = useDataFromEventLogs()\n\n  // get all proposal entities\n  const allProposals = useSingleContractMultipleData(govContract, 'proposals', proposalIndexes)\n\n  // get all proposal states\n  const allProposalStates = useSingleContractMultipleData(govContract, 'state', proposalIndexes)\n\n  if (formattedEvents && allProposals && allProposalStates) {\n    allProposals.reverse()\n    allProposalStates.reverse()\n\n    return allProposals\n      .filter((p, i) => {\n        return Boolean(p.result) && Boolean(allProposalStates[i]?.result) && Boolean(formattedEvents[i])\n      })\n      .map((p, i) => {\n        const formattedProposal: ProposalData = {\n          id: allProposals[i]?.result?.id.toString(),\n          title: formattedEvents[i].description?.split(/# |\\n/g)[1] || 'Untitled',\n          description: formattedEvents[i].description || 'No description.',\n          proposer: allProposals[i]?.result?.proposer,\n          status: enumerateProposalState(allProposalStates[i]?.result?.[0]) ?? 'Undetermined',\n          forCount: parseFloat(ethers.utils.formatUnits(allProposals[i]?.result?.forVotes.toString(), 18)),\n          againstCount: parseFloat(ethers.utils.formatUnits(allProposals[i]?.result?.againstVotes.toString(), 18)),\n          startBlock: parseInt(allProposals[i]?.result?.startBlock?.toString()),\n          endBlock: parseInt(allProposals[i]?.result?.endBlock?.toString()),\n          details: formattedEvents[i].details\n        }\n        return formattedProposal\n      })\n  } else {\n    return []\n  }\n}\n\nexport function useProposalData(id: string): ProposalData | undefined {\n  const allProposalData = useAllProposalData()\n  return allProposalData?.find(p => p.id === id)\n}\n\n// get the users delegatee if it exists\nexport function useUserDelegatee(): string {\n  const { account } = useActiveWeb3React()\n  const uniContract = useUniContract()\n  const { result } = useSingleCallResult(uniContract, 'delegates', [account ?? undefined])\n  return result?.[0] ?? undefined\n}\n\n// gets the users current votes\nexport function useUserVotes(): TokenAmount | undefined {\n  const { account, chainId } = useActiveWeb3React()\n  const uniContract = useUniContract()\n\n  // check for available votes\n  const uni = chainId ? UNI[chainId] : undefined\n  const votes = useSingleCallResult(uniContract, 'getCurrentVotes', [account ?? undefined])?.result?.[0]\n  return votes && uni ? new TokenAmount(uni, votes) : undefined\n}\n\n// fetch available votes as of block (usually proposal start block)\nexport function useUserVotesAsOfBlock(block: number | undefined): TokenAmount | undefined {\n  const { account, chainId } = useActiveWeb3React()\n  const uniContract = useUniContract()\n\n  // check for available votes\n  const uni = chainId ? UNI[chainId] : undefined\n  const votes = useSingleCallResult(uniContract, 'getPriorVotes', [account ?? undefined, block ?? undefined])\n    ?.result?.[0]\n  return votes && uni ? new TokenAmount(uni, votes) : undefined\n}\n\nexport function useDelegateCallback(): (delegatee: string | undefined) => undefined | Promise<string> {\n  const { account, chainId, library } = useActiveWeb3React()\n  const addTransaction = useTransactionAdder()\n\n  const uniContract = useUniContract()\n\n  return useCallback(\n    (delegatee: string | undefined) => {\n      if (!library || !chainId || !account || !isAddress(delegatee ?? '')) return undefined\n      const args = [delegatee]\n      if (!uniContract) throw new Error('No UNI Contract!')\n      return uniContract.estimateGas.delegate(...args, {}).then(estimatedGasLimit => {\n        return uniContract\n          .delegate(...args, { value: null, gasLimit: calculateGasMargin(estimatedGasLimit) })\n          .then((response: TransactionResponse) => {\n            addTransaction(response, {\n              summary: `Delegated votes`\n            })\n            return response.hash\n          })\n      })\n    },\n    [account, addTransaction, chainId, library, uniContract]\n  )\n}\n\nexport function useVoteCallback(): {\n  voteCallback: (proposalId: string | undefined, support: boolean) => undefined | Promise<string>\n} {\n  const { account } = useActiveWeb3React()\n\n  const govContract = useGovernanceContract()\n  const addTransaction = useTransactionAdder()\n\n  const voteCallback = useCallback(\n    (proposalId: string | undefined, support: boolean) => {\n      if (!account || !govContract || !proposalId) return\n      const args = [proposalId, support]\n      return govContract.estimateGas.castVote(...args, {}).then(estimatedGasLimit => {\n        return govContract\n          .castVote(...args, { value: null, gasLimit: calculateGasMargin(estimatedGasLimit) })\n          .then((response: TransactionResponse) => {\n            addTransaction(response, {\n              summary: `Voted ${support ? 'for ' : 'against'} proposal ${proposalId}`\n            })\n            return response.hash\n          })\n      })\n    },\n    [account, addTransaction, govContract]\n  )\n  return { voteCallback }\n}\n"]},"metadata":{},"sourceType":"module"}